<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Introducción</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Sri-clj</span> <span class="project-version">0.1.1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="intro.html"><div class="inner"><span>Introducción</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datil</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sri-clj</span></div></div></li><li class="depth-3 branch"><a href="datil.sri-clj.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-3"><a href="datil.sri-clj.authorization.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>authorization</span></div></a></li><li class="depth-4 branch"><a href="datil.sri-clj.authorization.service.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-4"><a href="datil.sri-clj.authorization.transform.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transform</span></div></a></li><li class="depth-3 branch"><a href="datil.sri-clj.config.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-3"><a href="datil.sri-clj.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-4 branch"><a href="datil.sri-clj.validation.service.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-4"><a href="datil.sri-clj.validation.transform.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transform</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#introducción" name="introducción"></a>Introducción</h1>
<h2><a href="#configura-la-dependencia-en-tu-proyecto" name="configura-la-dependencia-en-tu-proyecto"></a>Configura la dependencia en tu proyecto</h2>
<pre><code class="clojure">[sri-clj "1.0.0"]
</code></pre>
<h2><a href="#ambientes-del-sri" name="ambientes-del-sri"></a>Ambientes del SRI</h2>
<p><code>sri-clj</code> viene pre-configurada con los ambientes de pruebas y producción del SRI. Al llamar a cada función debes especificar el ambiente que quieres utilizar: <code>:test</code> (pruebas) o <code>:prod</code> (producción).</p>
<p>Si quieres usar tu propio servicio web de validación y autorización (por ejemplo en el caso de un <em>mock</em>), debes configurar las siguientes variables de ambiente:</p>
<table>
  <thead>
    <tr>
      <th>Variable </th>
      <th>Ejemplo </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>SRI_VALIDATION_TEST </td>
      <td><a href="http://mimock:8080/validate">http://mimock:8080/validate</a> </td>
    </tr>
    <tr>
      <td>SRI_AUTHORIZATION_TEST </td>
      <td><a href="http://mimock:8080/authorize">http://mimock:8080/authorize</a> </td>
    </tr>
    <tr>
      <td>SRI_VALIDATION_PROD </td>
      <td><a href="http://mimock:8080/validate">http://mimock:8080/validate</a> </td>
    </tr>
    <tr>
      <td>SRI_AUTHORIZATION_PROD </td>
      <td><a href="http://mimock:8080/authorize">http://mimock:8080/authorize</a> </td>
    </tr>
  </tbody>
</table>
<h2><a href="#firmado-electrónico" name="firmado-electrónico"></a>Firmado electrónico</h2>
<p>El primer paso de la emisión de un comprobante es el firmado electrónico.</p>
<pre><code class="clojure">;;; TO-DO
</code></pre>
<h2><a href="#validación-en-el-sri" name="validación-en-el-sri"></a>Validación en el SRI</h2>
<p>Envía el documento firmado al SRI para su validación.</p>
<pre><code class="clojure">(require '[sri-clj.validation :as val])
(val/validate-receipt :test (slurp ("resources/factura_firmada.xml")))
; -&gt; {:status "DEVUELTA",
;     :receipts [{:access-code "1410201601099271255400110010020000000091994726610",
;     :messages [{:type "ERROR",
;                 :additional-information "",
;                 :identifier "43",
;                 :message "CLAVE ACCESO REGISTRADA"}]}]}
</code></pre>
<h2><a href="#autorización-de-comprobantes" name="autorización-de-comprobantes"></a>Autorización de comprobantes</h2>
<p>Consulta el estado de autorización del comprobante en el SRI.</p>
<pre><code class="clojure">(require '[sri-clj.authorization :as aut])
(aut/authorize-receipt :test (slurp ("resources/factura_recibida.xml")))
; -&gt; {:access-code "0503201201176001321000110010030009900641234567814"
;     :receipt-count "1"
;     :authorizations [{:status "AUTORIZADO"
;                       :authorization-number "0503201201176001321000110010030009900641234567814"
;                       :authorization-date "2012-03-05T16:57:34.997-05:00"
;                       :environment "PRUEBAS"
;                       :receipt "&lt;![CDATA[&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;factura id="comprobante" version="1.0.0"&gt;...&lt;/factura&gt;]]&gt;"
;                       :messages [{:identifier "60"
;                                   :message "PROCESO DE PRUEBAS"
;                                   :type "ADVERTENCIA"}]}]}
</code></pre></div></div></div></body></html>